# тестовое задание LARAVEL + redis + СОКЕТЫ

цель задания:
- п.1 и п.2 - подготовка

- п.2, п.3, п.4, п.5 - тест на использование стандартных функций

- п.6 - тест на более редкую реализацию, но активно используемую у нас


1) ставим на сервер:
- php
- postgresql или mysql
- redis
- и что нужно для сокетов (на свое усмотрение)
2) устанавливаем LARAVEL

3) СТРАНИЦА 1: 
делаем страницу на которой можно авторизоваться через:
- логин+пароль, 
- FB (facebook), 
- STEAM или VK (эти системы более важны, поскольку FB идет по умолчанию)
отправка данных на сервер через AJAX. после получения ответа выводим на экран успешная или нет авторизации. при авторизации страница не перезагружается, но после перезагрузки надпись состояния авторизации остается

4) в SQL базе создаем таблицу и при авторизации в нее заносим список дат авторизации с привязкой к пользователям и страну авторизации. дата в ИНТ формате. в таблице есть уникальный ИД и есть уникальность по пользователю+дате (то есть добавить поле с одинаковой датой и одним и тем же пользователем невозможно). делаем аналогичную запись в redis (ниже будут уточнения)

5) СТРАНИЦА 2:
далаем вторую страницу на которой выводим список всех дат авторизации с привязкой к пользователю. SQL запрос на выгрузку через JOIN (связываем таблицу юзеров и дат авторизации)

6) при авторизации на СТРАНИЦЕ 2 появляется новая строка (без обновления, через сокеты). при чем вытягиваем с SQL базы, а используем redis. то есть при первой загрузке страницы выгружает через SQL запрос, а потом через СОКЕТЫ вытягивает с redis обновления

- дизайн не нужен, фронтенд минимальный. главное чтобы работало
- делаем что выходит и как выходит. если не вышло, то пункт можно пропустить
- как собирать через докер или еще как-то на личный выбор
- прилагать пояснительную записку с кратким описание что готово и как реализовывали и все доступы которые создавали (например к SQL базе)

# project

Проект разрабатывался на виртуальном сервере с такими параметрами (.env)

APP_NAME=Project

APP_ENV=local

APP_KEY=base64:F88AOQCc8pp0miuc/t9mTRivyeVMEkW3gJE8wXIlS2w=

APP_DEBUG=true

APP_LOG_LEVEL=debug

APP_URL=http://project.dev/


DB_CONNECTION=mysql

DB_HOST=127.0.0.1

DB_PORT=3306

DB_DATABASE=project

DB_USERNAME=root

DB_PASSWORD=123


BROADCAST_DRIVER=log

CACHE_DRIVER=array

SESSION_DRIVER=file

QUEUE_DRIVER=sync


REDIS_HOST=127.0.0.1

REDIS_PASSWORD=null

REDIS_PORT=6379


FACEBOOK_CLIENT_ID=1732920243673867

FACEBOOK_CLIENT_SECRET=564464b145a21284dfa0ade392a3f550

CALLBACK_URL=http://project.dev/auth/facebook/callback


VKONTAKTE_KEY=6154265

VKONTAKTE_SECRET=iHrrb9me591u2rzQpBUW

VKONTAKTE_REDIRECT_URI=http://project.dev/auth/vkontakte/callback


Реализованы пункты 1-5.

"СТРАНИЦА 1" называется в меню "Login" (авторизация через логин+пароль, facebook, vkontakte, социальные аккаунты пишутся в БД в таблицу user_social_accounts). Авторизация реализована используя 5dmatweblogin/ajaxlogin, через фейсбук используя laravel/socialite, через vkontakte используя socialiteproviders/vkontakte

"СТРАНИЦА 2" называется в меню "Login whith GeoIP" (авторизация через логин+пароль, запись страны и даты успешного логина в БД в таблицу user_geoip_logs). Определение страны осуществляется при помощи torann/geoip

Для хранения лога успешных авторизаций используется Redis (при отсутствии соответствующего кеша идёт запрос в БД). Кеш лога удаляется при успешной авторизации пользователя.

Для отправки push-уведомлений о новых авторизациях использовал Vue.js and Pusher 2.6
